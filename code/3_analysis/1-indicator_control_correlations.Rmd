---
title: "Indicator and Control Correlations"
author: "Johanna Mehler"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true               # Enable Table of Contents
    toc_float:              # Make the TOC floating
      collapsed: false      # Do not collapse TOC by default
      smooth_scroll: true   # Smooth scrolling to sections
    number_sections: true   # Numbered sections
    theme: readable         # Use a predefined theme for styling (optional)
    highlight: tango        # Syntax highlighting style (optional)
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Prepare Data

```{r}
library(tidyverse)
library(here)
library(stats)
library(GGally)
library(corrplot)
library(descr)

data <- read_csv(here("data/data_combined.csv"))

# select indicators
data_indicators <- data %>% 
  select(cluster, text_length_log2, readability_score, leftright_pred_error) %>% # add cluster/type indicator later
  drop_na() %>% 
  filter(readability_score < 40) # remove 2 extreme outliers

# select controls (categorical)
controls_cat <- data %>% select(academic_status, gender, age_cat, polinterest_cat_3, empathy_pc_cat, exp_hate_speech_cat, exp_hostile_engagement_cat, commitment_cat) %>% drop_na()

# select controls (numerical)
controls_num <- data %>% select(academic_status, age10, polinterest, empathy_pc, exp_hate_speech, exp_hostile_engagement, commitment_log2) %>% drop_na()
```

# Correlations between Indicators

## Scatter Plots and Correlation

```{r}
# select indicators in a different order (continous variables first)
indicators <- c("text_length_log2", "readability_score", "leftright_pred_error", "cluster")

ggpairs(data_indicators, columns = indicators)
```


## Correlation Matrix (without significance)

```{r}
# chose only numeric indicators
data_indicators_num <- data_indicators %>% 
  select(text_length_log2, readability_score, leftright_pred_error)

cor_matrix <- cor(data_indicators_num, method = "pearson")
cor_matrix
```


## Correlation Plot

```{r}
cor_matrix %>% corrplot(method = "color", type = "lower", tl.cex = 1, tl.col = "black", addCoef.col = "black")
```


# Correlations between Controls

## Correlation Matrix (without significance)

```{r}
controls_num_selection <- controls_num %>% select(-academic_status)

cor_matrix <- cor(controls_num_selection, method = "spearman")
cor_matrix
```

## Correlation Plot

```{r}
cor_matrix %>% corrplot(method = "color", type = "lower", tl.cex = 1, tl.col = "black", addCoef.col = "black")
```


## Try Outs: Relationship between Educ_cat and my potential controls

```{r}
# Relationship between EDU and Experience with Online hostile Engagement
crosstab(data$exp_hostile_engagement_cat, data$educ_cat, prop.c = TRUE)

crosstab(data$exp_hate_speech_cat, data$educ_cat, prop.c = TRUE)

crosstab(data$polinterest_cat_3, data$educ_cat, prop.c = TRUE)

crosstab(data$polinterest, data$educ_cat, prop.c = TRUE)

crosstab(data$empathy_pc_cat, data$educ_cat, prop.c = TRUE)

crosstab(data$leftright, data$educ_cat, prop.c = TRUE)

```

## Relationship between control variables


```{r}
# Function to plot relationships between all pairs of variables in a dataframe
plot_relationships <- function(df) {
  # Initialize list to store plots
  plots <- list()
  plot_count <- 1
  col_names <- names(df)
  
  # Loop through all unique pairs of variables
  for (i in seq_len(ncol(df) - 1)) { # Exclude the last column 'gender' from the x-axis variables
    for (j in (i+1):ncol(df)) {
      x <- col_names[i]
      y <- col_names[j]
      
      # Create scatter plot for each pair
      plot <- ggplot(df, aes_string(x = x, y = y)) + 
        geom_point(position = position_jitter(width = 0.2, height = 0.2), alpha = 0.6, color = "skyblue") +
        geom_smooth(method = "lm", colour = "black", linewidth = 0.5) +
        theme_minimal() +
        labs(title = paste("Scatter plot between", x, "and", y))
      
      # Store the plot in the list
      plots[[plot_count]] <- plot
      plot_count <- plot_count + 1
    }
  }
  
  # Print plots
  lapply(plots, print)
}

```

### Create scatter plots for categorical measurement

```{r}
# use only categorical variables
controls_cat <- controls_cat %>% select(-academic_status)

plot_relationships(controls_cat)
```

### Create scatter plots for numerical measurement

```{r}
controls_num <- controls_num %>% select(-academic_status)

plot_relationships(controls_num)
```






