---
title: "Regressions"
author: "Johanna Mehler"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true               # Enable Table of Contents
    toc_float:              # Make the TOC floating
      collapsed: false      # Do not collapse TOC by default
      smooth_scroll: true   # Smooth scrolling to sections
    number_sections: true   # Numbered sections
    theme: readable         # Use a predefined theme for styling (optional)
    highlight: tango        # Syntax highlighting style (optional)
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Data preparation

## Libraries and read in data

```{r}
library(tidyverse)
library(readr)
library(here)
library(table1)
library(ggplot2)
library(lmtest)
library(stargazer)
```


```{r}
# data <- read_csv(here("data/data_combined.csv"))

data <- read_csv(here("data", "data_combined.csv"), 
                 col_types = cols(
                   academic_status = col_factor(levels = c("non-academic", "academic")),
                   educ_cat = col_factor(levels = c("Low", "Intermediate", "High")), 
                   gender = col_factor(levels = c("Male", "Female", "Other")), 
                   monority_cat = col_factor(levels = c("Non-minority", "Minority")),
                   age_cat = col_factor(levels = c("18-29", "30-49", "50-69", "70+")),
                   polinterest_cat_3 = col_factor(levels = c("Low", "Intermediate", "High")),
                   empathy_pc_cat = col_factor(levels = c("Less empathetic", "More empathetic")),
                   exp_hate_speech_cat = col_factor(levels = c("Less experience", "More experience")), 
                   exp_hostile_engagement_cat = col_factor(levels = c("Less experience", "More experience")), 
                   cluster = col_factor(levels = c("Intent-based", "Harms-based", "Harms-based narrow", "Denying/Nonsense")),
                   leftright_cat = col_factor(levels = c("liberal/left", "moderate/center", "conservative/right")),
                   commitment_cat = col_factor(levels = c("Below average", "Above average"))
                 ))

# filter out NA's in academic status and extreme outliers
data <- data %>% filter(!is.na(educ_cat), !is.na(academic_status), text_length < 1000, readability_score < 40)

# check data types and scales
data %>% summary()
```


# Regressions

## Text Length

```{r}
# Linear regression model with all controls
model_text_length <- lm(text_length_log2 ~ academic_status + gender + age_cat + leftright_cat + commitment_log2, data = data)

summary(model_text_length)

stargazer(model_text_length, type = "text")
```

***Residuals Plot for Homoscedasticity and Linearity***

check if the residuals (differences between observed and predicted values) display constant variance across all levels of the predicted values (homoscedasticity) and if the relationship between the predictors and the outcome is linear.

**Homoscedasticity**: The spread of residuals should be roughly constant across all fitted values.

**Linearity**: The residuals should be randomly dispersed around the horizontal axis, without any systematic shape.

```{r}
# Plotting residuals vs. fitted values
plot(model_text_length, which = 1)
```

***Q-Q Plots for Normality of Residuals***

Q-Q (quantile-quantile) plot to assess whether the residuals follow a normal distribution

```{r}
# Q-Q plot
qqnorm(residuals(model_text_length))
qqline(residuals(model_text_length))
```

***Variance Inflation Factor (VIF) for Multicollinearity***

Assesses how much the variance of a coefficient is inflated due to multicollinearity in the model. VIF values above 5 or 10 indicate high multicollinearity that could be problematic.

```{r}
library(car)

vif(model_text_length)
```



## Readability

```{r}
# Linear regression model with all controls
model_readability <- lm(readability_score ~ academic_status + gender + age_cat + leftright_cat + commitment_log2, data = data)

summary(model_readability)

stargazer(model_readability, type = "text")
```



***Residuals Plot for Homoscedasticity and Linearity***

check if the residuals (differences between observed and predicted values) display constant variance across all levels of the predicted values (homoscedasticity) and if the relationship between the predictors and the outcome is linear.

**Homoscedasticity**: The spread of residuals should be roughly constant across all fitted values.

**Linearity**: The residuals should be randomly dispersed around the horizontal axis, without any systematic shape.

```{r}
# Plotting residuals vs. fitted values
plot(model_readability, which = 1)
```



***Q-Q Plots for Normality of Residuals***

Q-Q (quantile-quantile) plot to assess whether the residuals follow a normal distribution

```{r}
# Q-Q plot
qqnorm(residuals(model_readability))
qqline(residuals(model_readability))
```

***Variance Inflation Factor (VIF) for Multicollinearity***

Assesses how much the variance of a coefficient is inflated due to multicollinearity in the model. VIF values above 5 or 10 indicate high multicollinearity that could be problematic.

```{r}
library(car)

vif(model_readability)
```


## Predictability of Political Orientation


```{r}
## Linear regression model with all controls
#model_leftright_pred_error <- lm(leftright_pred_error ~ academic_status + gender + #age_cat + leftright_cat + commitment_log2, data = data)
#
#summary(model_leftright_pred_error)
#
#stargazer(model_leftright_pred_error, type = "text")
```



***Residuals Plot for Homoscedasticity and Linearity***

check if the residuals (differences between observed and predicted values) display constant variance across all levels of the predicted values (homoscedasticity) and if the relationship between the predictors and the outcome is linear.

**Homoscedasticity**: The spread of residuals should be roughly constant across all fitted values.

**Linearity**: The residuals should be randomly dispersed around the horizontal axis, without any systematic shape.

```{r}
# Plotting residuals vs. fitted values
plot(model_text_length, which = 1)
```



***Q-Q Plots for Normality of Residuals***

Q-Q (quantile-quantile) plot to assess whether the residuals follow a normal distribution

```{r}
# Q-Q plot
#qqnorm(residuals(model_text_length))
#qqline(residuals(model_text_length))
```

***Variance Inflation Factor (VIF) for Multicollinearity***

Assesses how much the variance of a coefficient is inflated due to multicollinearity in the model. VIF values above 5 or 10 indicate high multicollinearity that could be problematic.

```{r}
#library(car)
#
#vif(model_text_length)
```

## Model Table

```{r}
# create Latex table
stargazer(model_text_length, model_readability,
          dep.var.labels = c("Text length (log2)", "Readability"),
          covariate.labels = c("Academic", "Female", "Other", "30-49", "50-69", "70+", "Moderate/Center", "Conservative/Right", "Survey Commitment (log2)")
          )

# create text table
stargazer(model_text_length, model_readability, type = "text",
          dep.var.labels = c("Text length (log2)", "Readability"),
          covariate.labels = c("Academic", "Female", "Other", "30-49", "50-69", "70+", "Moderate/Center", "Conservative/Right", "Survey Commitment (log2)")
          )
```


## Cluster (multinomial logistic regression)


```{r}
library(nnet)

# Fit multinomial logistic regression model
model_cluster <- multinom(cluster ~ academic_status + gender + age_cat + leftright_cat + commitment_log2, data = data)

summary(model_cluster)

# create text table
stargazer(model_cluster, type = "text")

# create Latex table
stargazer(model_cluster,
          covariate.labels = c("Academic", "Female", "Other", "30-49", "50-69", "70+", "Moderate/Center", "Conservative/Right", "Survey Commitment (log2)")
          )
```


