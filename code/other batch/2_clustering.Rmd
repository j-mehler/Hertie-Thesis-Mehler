---
title: "2_Clustering"
author: "Johanna Mehler"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true               # Enable Table of Contents
    toc_float:              # Make the TOC floating
      collapsed: false      # Do not collapse TOC by default
      smooth_scroll: true   # Smooth scrolling to sections
    number_sections: true   # Numbered sections
    theme: readable         # Use a predefined theme for styling (optional)
    highlight: tango        # Syntax highlighting style (optional)
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Preparation

```{r}
# libraries
library(tidyverse)
library(here)
library(cluster)
library(factoextra)
library(ggplot2)
```


```{r}
# load data
data <- read_csv(here("data/data_numeric_filtered_2.csv"))

# remove columns with only zeros
data <- data %>% select_if(~any(. != 0))

# set theme
theme_set(theme_minimal())
```

# PAM clustering

## Finding the best number of clusters

### Silhouette Method

The silhouette coefficient is a measure of how similar an object is to its own cluster (cohesion) compared to other clusters (separation). The silhouette score ranges from -1 to +1, where a high value indicates that the object is well matched to its own cluster and poorly matched to neighboring clusters.

```{r}
# Finding the optimal number of clusters using the silhouette method (higher )
fviz_nbclust(data, FUN = pam, method = "silhouette", k.max = 15)
```

With my second batch: 5 seems to be good

### Elbow Method

The elbow method involves plotting the total within-cluster sum of squares (WSS) against the number of clusters, k, and looking for a 'knee' in the plot where the rate of decrease sharply changes. This 'elbow' typically indicates a good number of clusters to use.

```{r}
# Finding the optimal number of clusters using the elbow method
fviz_nbclust(data, FUN = pam, method = "wss", k.max = 15)
```

Confirms result from silhoutte approach.

## PAM Method with 5 clusters

```{r}
# The PAM algorithm is based on the search for k representative objects or medoids among the observations of the data set.
optimal_k <- 5 # Example value
pam_result <- pam(data, k = optimal_k, metric = "euclidean")
```

### Best Representatives of Each Cluster

```{r}
# Printing the medoids
medoids <- pam_result$medoids

medoid_indices <- pam_result$id.med # getting medoid indices

# Loop through each medoid and print the variable names where the value is 1
for (i in medoid_indices) {
  medoid_row <- data[i, ] # Subsetting the specific medoid row
  
  # Getting variable names where the medoid has a value of 1
  vars_with_value_1 <- names(medoid_row)[which(medoid_row == 1)]
  
  cat("Medoid", i, "items:\n")
  print(vars_with_value_1)
  cat("\n")
}

```
### Visualize

```{r}
# visualize 
fviz_cluster(pam_result, data = data_filtered)
```


## PAM Method with 4 clusters

```{r}
# The PAM algorithm is based on the search for k representative objects or medoids among the observations of the data set.
optimal_k <- 4 # Example value
pam_result <- pam(data, k = optimal_k, metric = "euclidean")
```

### Best Representatives of Each Cluster

```{r}
# Printing the medoids
medoids <- pam_result$medoids

medoid_indices <- pam_result$id.med # getting medoid indices

# Loop through each medoid and print the variable names where the value is 1
for (i in medoid_indices) {
  medoid_row <- data[i, ] # Subsetting the specific medoid row
  
  # Getting variable names where the medoid has a value of 1
  vars_with_value_1 <- names(medoid_row)[which(medoid_row == 1)]
  
  cat("Medoid", i, "items:\n")
  print(vars_with_value_1)
  cat("\n")
}

```
### Visualize

```{r}
# visualize 
fviz_cluster(pam_result, data = data_filtered)
```


## PAM Method with 2 clusters

```{r}
# The PAM algorithm is based on the search for k representative objects or medoids among the observations of the data set.
optimal_k <- 2 # Example value
pam_result <- pam(data, k = optimal_k, metric = "euclidean")
```

### Best Representatives of Each Cluster

```{r}
# Printing the medoids
medoids <- pam_result$medoids

medoid_indices <- pam_result$id.med # getting medoid indices

# Loop through each medoid and print the variable names where the value is 1
for (i in medoid_indices) {
  medoid_row <- data[i, ] # Subsetting the specific medoid row
  
  # Getting variable names where the medoid has a value of 1
  vars_with_value_1 <- names(medoid_row)[which(medoid_row == 1)]
  
  cat("Medoid", i, "items:\n")
  print(vars_with_value_1)
  cat("\n")
}

```

### Visualize

```{r}
# visualize 
fviz_cluster(pam_result, data = data_filtered)
```