---
title: "Hate Speech Definitions - Descriptives"
author: "Johanna Mehler"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggplot2)

# load reprocessed data
data_all <- read_csv("~/OneDrive/1_Hertie Studies/Thesis/Hertie-Thesis-Mehler/data/data_clean2.csv")

# filter: for now only English answers (because the others are not translated yet)
data_en <- data_all %>% filter(Q_Language == "EN")

# we are left with three countries: usa (2945), phleng (837), nig (464)
data_en %>% select(country) %>% unique()

# select variables of interest
data <- data_en %>% select(open_hatedefinition, gender, age_cat, minority_cat, academic_status)
```

# First Descriptives

## Missingness

Hate Definition (open_hatedefinition): 19.4 per cent missing -> see data report

Seen that there is high missingness (19.4%) in my outcome variable, I want to find out more about people who did not specify their own definition of hate speech.

```{r}
# Filter rows where open_hatedefinition is missing
missing_hatedef <- data %>% 
  filter(is.na(open_hatedefinition)) %>% select(gender, age_cat, minority_cat, academic_status)

not_missing_hatedef <- data %>% 
  filter(!is.na(open_hatedefinition)) %>% select(gender, age_cat, minority_cat, academic_status)

# Comparing sociodemographics of those who did not answer with the rest

# Plotting for each variable
variables <- c('gender', 'age_cat', 'minority_cat', 'academic_status')

for (var in variables) {
  # Plot for missing_hatedef dataset
  p1 <- ggplot(data = missing_hatedef, aes(x = .data[[var]])) +
    geom_bar() +
    theme_minimal() +
    labs(title = paste("Missing:", var))
  
  # Plot for not_missing_hatedef dataset
  p2 <- ggplot(data = not_missing_hatedef, aes(x = .data[[var]])) +
    geom_bar() +
    theme_minimal() +
    labs(title = paste("Not Missing:", var))
  
  # Combine plots
  plot_list <- list(p1, p2)
  multiplot <- cowplot::plot_grid(plotlist = plot_list, nrow = 1)
  
  # Show the plots
  print(multiplot)
}
```

Gender: seems not to be important for this.
Age: in the age of 18-29, much less people are missing a definition -> make a more sophisticated plot out of this (with percentages only)
Minority: have provided a bit more information -> also show in plot
Academic: slightly different in non-academics -> also show in plot!

### Calculate Percentages of each value in each group

```{r}
# group "missing"

# convert to long format
missing_hatedef_long <- missing_hatedef %>% 
  pivot_longer(cols = c("gender", "age_cat", "minority_cat", "academic_status"), names_to = "variable", values_to = "value")

# summarize counts
missing_hatedef_summary <- missing_hatedef_long %>% group_by(variable, value) %>% count()

# calculate total of each variable
total <- missing_hatedef %>% nrow()

# add total and share of each value, and dataset variable "missing"
missing_hatedef_summary <- missing_hatedef_summary %>% mutate(
  total = total,
  share = n/total,
  dataset = "Missing"
)


# group "not missing"

# convert to long format
not_missing_hatedef_long <- not_missing_hatedef %>% 
  pivot_longer(cols = c("gender", "age_cat", "minority_cat", "academic_status"), names_to = "variable", values_to = "value")

# summarize counts
not_missing_hatedef_summary <- not_missing_hatedef_long %>% group_by(variable, value) %>% count()

# calculate total of each variable
total <- not_missing_hatedef %>% nrow()

# add total and share of each value, and dataset variable "not missing"
not_missing_hatedef_summary <- not_missing_hatedef_summary %>% mutate(
  total = total,
  share = n/total,
  dataset = "Not Missing"
)

# combine missing and not missing dataset summaries
missingness_sociodemographics <- rbind(missing_hatedef_summary, not_missing_hatedef_summary)
```



### create plots

```{r}
# bar plot
missingness_sociodemographics %>% 
  ggplot(aes(x = share, y = value, fill = dataset)) +
  geom_bar(stat = "identity", position = "dodge") + # Use geom_bar to create a bar plot
  facet_wrap(~variable, scales = "free") + # Separate plots for each Region
  labs(title = "Product Counts by Region", x = "Share", y = "Value")
```


```{r}
# plot with geom_point
missingness_sociodemographics %>% 
  ggplot(aes(x = share, y = value)) +
  geom_point(aes(color = dataset), stat = "identity") + # Use geom_bar to create a bar plot
  geom_line(aes(group = value), color = "black", show.legend = FALSE) +
  facet_wrap(~variable, scales = "free") + # Separate plots for each Region
  labs(title = "Sociodemographics of those Missing compared to existing answers", x = "Share", y = "Value")
```

Are these differences significant? Maybe do a t-test as well? -> noch die Berechnung der Zahlen im Folgenden überprüfen!!!! Ist SD und die upper lower edges wirklich richtig berechnet??? per Hand Beispiel durchrechnen

```{r}
# plot without line but with confident intervals

# Add standard error and confidence interval bounds to the dataframe
missingness_sociodemographics <- missingness_sociodemographics %>%
  mutate(
    share = as.numeric(share), # Ensure that 'share' is numeric
    SE = sqrt(share * (1 - share) / total), # Standard error of the proportion
    z_value = qnorm(0.975), # z-value for a 95% CI; adjust if you want a different CI level
    lower = share - z_value * SE, # Lower bound of the CI
    upper = share + z_value * SE # Upper bound of the CI
  )

# Now, create the plot with pointranges
ggplot(missingness_sociodemographics, aes(x = factor(value), y = share, color = dataset)) +
  geom_pointrange(aes(ymin = lower, ymax = upper), position = position_dodge(width = 0.1), fatten = 3) +
  facet_wrap(~variable, scales = "free") +
  labs(title = "Sociodemographics of those Missing compared to existing answers",
       x = "Value", y = "Share") 
```
academic status, gender, minority_cat = not significantly different
age = different!

These differences are not all significant. The high missingness quota could maybe be traced back to the very long survey experiment and missing incentives to take a lot of time at the end to answer the questions (answering time for the open text questions was highest compared to all other items of the survey).


## Text Length 

```{r}
# Calculate Word Counts
data_wordcount <- data %>%
  mutate(word_count_hatedef = strsplit(as.character(open_hatedefinition), " ") %>%
           sapply(length))

# Create Distribution Plot for open_hatedefinition

# Adjust binwidth for open_hatedefinition
binwidth_hatedef = max(1, floor((392 - 1) / 30))  # for a reasonable number of bins

# Plot for open_hatedefinition
ggplot(data_wordcount, aes(x = word_count_hatedef)) +
  geom_histogram(binwidth = binwidth_hatedef, fill = "skyblue", color = "black") +
  xlim(c(0, 400)) +  # Adjust x-axis limits
  labs(title = "Word Count Distribution: open_hatedefinition",
       x = "Word Count",
       y = "Frequency")
```

Almost all answers have a length below 100.
